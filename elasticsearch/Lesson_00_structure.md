# Структура elasticsearch

## Шарды

Или другое название - осколки, поскольку является частью (осколком) самого индекса.

`Шард` - это логическая единица хранения данных.

> На самом деле шард является инстансом поисковой системы Apache Lucene.

При создании индекса по умолчанию создаётся два шарда: `мастер` и `реплика`.

## Узлы или ноды (Node)

`Нода` - запущенный экземпляр elasticsearch.

- Каждая нода может содержать различные шарды, или не содержать их вовсе, в зависимости от роли.

- При создании индекса создаётся два шарда: мастер и реплика, но при этом создаётся одна нода.

- Реплика не должна находиться на одной и той же ноде с мастером, поэтому шард реплики не будет работать.

- Чтобы шард реплики заработал - необходимо добавить ещё одну ноду. Несколько шардов реплик могут работать на одной ноде.

### Роли узлов

У нод есть следующие роли:

`Master-eligible node` - самая главная нода, которая управляет всем кластером

`Data node` - отвечает за хранение данных, их поиск, агрегирование и т.д.

`Ingest node` - отвечает за загрузку документов, предварительную обработку, индексацию

`Machine learning node` - роль, отвечающая за машинное обучение

`Coordination` - отвечает за координацию запросов и делегирует их data нодам (используется для больших кластеров)

> По умолчанию для одной ноды создаётся три роли dim, что расшифровывается как: `data`, `ingest`, `master`

> Если роль `master` присвоена нескольким нодам, 
> то главная `master` нода выбирается с помощью механизма голосования

## Кластер

Кластером является совокупность нод (узлов).
