# Полнотекстовый поиск

В полнотекстовом поиске используется оператор `match`
При вызовера оператора `match` задействуется анализатор.

## Поиск по совпадениям

Пример:

```http

GET /recipes/_search
{
  "query": {
    "match": {
      "title": "pasta or spaghetti"
    }
  }
}
```

По умолч**анию используется оператор OR. 
Поэтому** искаться будут все документы, если в них упоминается хотя бы одно любое слово из запроса.

Чтобы изменить поведение, например, чтобы искались только документы, в которых содержатся все слова из запроса - 
необходимо использовать оператор AND:

```http
GET /recipes/_search
{
  "query": {
    "match": {
      "title": {
        "query": "pasta or spaghetti",
        "operator": "and"
      }
    }
  }
}
```

    ! Мы всё ещё ищем токены (термины), 
    просто используя оператор `match` вызывается анализатор, который предварительно разбивает запрос на термины

## Поиск по фразе

Используется параметр `match_phrase`:

```http
GET /recipes/_search
{
  "query": {
    "match_phrase": {
      "title": {
        "query": "spaghetti puttanesca"
      }
    }
  }
}
```

Найдёт документы, где используется эта фраза точно в таком же порядке.

> Для смягчения поиска используется параметр `slop` - дистанция между словами фразы

    Технический трюк: использовать вместо обычного запроса match_phrase
    дополнительный bool запрос (далее в лекции) с match для улучшения релевантного поиска

Пример:
```http
GET /recipes/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "title": "spaghetti puttanesca"
          }
        }
      ],
      "should": [
        "match_phrase": {
          "title": {
            "query": "spaghetti puttanesca"
          }
        }
      ]
    }
  }
}
```

## Поиск по нескольким полям

Используется параметр `multi_match`

Поля передаются в виде массива в параметре `fields`

Пример:

```http
GET /recipes/_search
{
  "query": {
    "multi_match": {
      "query": "pasta",
      "fields": ["title", "description"]
    }
  }
}
```

## Неточные запросы. Fuzzy

Иногда в запросе может проскочить ошибка или неточность, например, вместо слова "Абрикос" -> "Абрик0c".
При этом нам необходимо найти документы даже по таким фразам.

Для этого используются fuzzy запросы.

`fuzzyness` - параметр, отвечающий за расстояние (букв) редактирования в запросе, "auto" - автоматическое расстояние

```http
GET /recipes/_search
{
  "query": {
    "match": {
      "title": {
        "query": "l0bster",
        "fuzziness": "auto"
      }
    }
  }
}
```

>Fuzzy запросы не анализируются, поэтому работают напрямую с токенами.
 
> Так же вместо `query` используется `value` внутри запроса

Пример fuzzy запроса:

```http
GET /recipes/_search
{
  "query": {
    "fuzzy": {
      "title": {
        "value": "l0bster",
        "fuzziness": "auto"
      }
    }
  }
}
```
