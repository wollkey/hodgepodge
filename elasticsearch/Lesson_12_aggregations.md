# Агрегация

Агрегация задаётся через параметр `aggs`

```json
GET /order/_search
{
  "size": 0,
  "aggs": {
    "sum_sale": {
      "sum": {
        "field": "lines.amount"
      }
    },
    "avg_sale": {
      "avg": {
        "field": "lines.amount"
      }
    }
  }
}
```

`sum_sale` и `avg_sale` - названия результирующего поля, можно называть как угодно

`sum`, `avg`, etc. - функции агрегирования

`field` - поля, по которым агрегируем

Результат:
```json
{
  ...,
  "aggregations" : {
    "avg_sale" : {
      "value" : 54.96205839033276
    },
    "sum_sale" : {
      "value" : 109209.61002159119
    }
  }
}
```

`aggregations` - поле, в котором возвращается результат агрегации

Помимо базовых агрегирующих функций `avg`, `sum`, `min`, `max` есть и другие:

`value_count` - кол-во значений

`cardinality` - кол-во уникальных значений, похоже на DISTINCT в SQL

`stats` - возвращает несколько значений: `count`, `min`, `max`, `avg`, `sum`

`terms` - группирует по значениям и считает кол-во документов каждого значения, похоже на GROUP BY в SQL

`histogram` - строит гистограмму по выбранному полю и выставленному интервалу

`global` - использует для агрегации все документы, даже если в запросе указаны ограничения поиска

`missing` - агрегирует по полям, которые отсутствуют в документе или если значение у поля null

`nested` - агрегация по вложенным документам